<html ng-app="soundExplorer">
<head>
<script src="/vendor/angular/angular.min.js"></script>
<script src="/vendor/jquery/dist/jquery.min.js"></script>
<script src="/vendor/socket.io-client/socket.io.js"></script>
<script src="http://connect.soundcloud.com/sdk-2.0.0.js"></script>
<script src="/js/app.js"></script>
<script src="/js/searchController.js"></script>
<script>

	var scClientId = 'ebbf3ff65dfc82e8188aa1ea90c85a7b';

	$(document).ready(function() {

		SC.initialize({
			client_id: scClientId
		});

		var socket = io.connect();
		var currentSound;

		socket.on('new song', function(track) {

			console.log('play new track ' + track);

			SC.stream("/tracks/" + track.trackId, function(sound) {

				if (currentSound) {
					currentSound.stop();
				}

				currentSound = sound;

				console.log("Sound uri: " + sound.uri + " at position " + track.position);
				sound.seek(track.position);
				console.log("Current playing position " + sound.getCurrentPosition());
				sound.play();

			});
		});

		/*var track_url = 'http://soundcloud.com/forss/flickermood';
		SC.oEmbed(track_url, { auto_play: true }, function(oEmbed) {
		  console.log('oEmbed response: ' + oEmbed);
		});*/


		/*SC.stream("/tracks/153440469", function(sound) {
			console.log("Sound uri: " + sound.uri);
			sound.play();
		});*/

		/*SC.get("/fox-amoore/tracks", {limit: 1}, function(tracks){
  			console.log("Latest track: " + tracks[0].title);
		});*/

	});

	function getSongData() {

		var trackId = $("#songInput").val();

		$.ajax({
			type: "GET",
			url: "http://api.soundcloud.com/tracks/" + trackId + ".json?client_id=" + scClientId,
			success: function(data) {

				if (data) {

					console.log(data);
					useSong({ 'trackId' : trackId, 'duration' : data.duration });
				}

			}
		});
	}

	function useSong(song) {

		var requestUrl = '/api/request/';
		$.ajax({
				type: "PUT",
				url: requestUrl,
				data: JSON.stringify(song),
				contentType: "application/json; charset=utf-8",
				success: function(msg) {
					console.log(msg);
				}
		});

	}

</script>
</head>

<body>


<input type="text" id="songInput" />
<button id="_songSubmit" onclick="getSongData()">Submit song</button>

</body>

</html>
